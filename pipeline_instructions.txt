1. Log in to phylocluster. Change into /share/WilkeLab/AG3C/data/experiments/ directory. Change into the directory for the desired time course. Copy the data structure in that directory using this function:

tar -cvf hydra_data_structure.tar sample*/RNA/

tar function combines multiple files and directories into a single file

2. Log in to @lonestar.tacc.utexas.edu. Change into scratch and make a "data" directory. Change into "data" and make a folder for a given time course (ex:glucose). Copy the data structure file from hydra to that directory:

cd $SCRATCH
mkdir data
cd data
mkdir glucose_time_course
cd glucose_time_course
scp username@phylocluster.ccbb.utexas.edu:/share/WilkeLab/AG3C/data/experiments/*_time_course/hydra_data_structure.tar .

3. Once you copied the tar file into that directory, unfold the tar file using:

tar -xvf hydra_data_structure.tar

4. You should now have the exact same data structure in $SCRATCH/data/*_time_course/ as in the /share/WilkeLab/AG3C/data/experiments/*_time_course. Make a folder unanalyzed_raw_reads in the same directory to store unanalyzed raw reads pertaining to that time course. Copy all of the reads into that directory. 

5. Change into Ecoli_RNAseq/src/. Run this shell script to make sample*/RNA/*depleted.raw and move the raw reads there (change TIME_COURSE_DIR variable in move_raw_reads.sh to match the time course directory your data is in) by typing:

./move_raw_reads.sh

6. Concatenate reads, if multiple fastq files are present for one sample's each read. Run this function in the same directory (Ecoli_RNAseq/src/) to write a paramlist file that will concatenate all the reads: 

./write_paramlist_concatenate.sh

7. Change into $SCRATCH/data/ and run the concatenation:

chmod +x paramlist_concatenate
./paramlist_concatenate

This will take about 20 mins. The concatenated reads would appear in $SCRATCH/*_time_course/sample*/RNA/*depleted.processed/

7. Now you can make a paramlist file to run the bowtie pipeline in parallel for each sample. Change into Ecoli_RNAseq/src/ and run this function (change TIME_COURSE_DIR variable in write_paramlist_bowtie.sh to match the time course directory your data is in):

./write_paramlist_bowtie.sh

8. Change into Ecoli_RNAseq/job_submissions_files/. Correct the line in bowtie_launcher.sge that says "setenv CONTROL_FILE   paramlist_bowtie_*". "paramlist_bowtie_*" is the file that was written by running ./write_paramlist_bowtie.sh. "*" here stands for the time course you are analyzing.  

9. Now you are ready to submit the job to TACC. Change into $SCRATCH/data/ and run:

qsub $HOME/Ecoli_RNAseq/job_submissions_files/bowtie_launcher.sge 

You can check the status of your job by entering "qstat" function. All of the files generated by the pipeline will appear in SCRATCH/*_time_course/sample*/RNA/*depleted.processed/. 

10. Once the pipeline is done running, you need to combine all the quality control files into one file. Change into the *_time_course (ex: glucose_time_course) and run:

cat sample*/RNA/*depleted.processed/*_quality_control.txt > quality_control_glucose.csv 

Open this file in excel and delete every other line that contains headers from each sample (cat function adds all of the lines in each sample).

11. To copy the new data generated to hydra, change into Ecoli_RNAseq/src/. Change DATA_DIR, SAMPLES, DEST_DIR, and TAR_NAME in both make_tar_processed.sh and make_tar_raw.sh. Run both of them:
 
./make_tar_processed.sh   
./make_tar_raw.sh

This scripts will write tar files for raw and processed read files (ex:TAR_NAME_processed.tar, TAR_NAME_raw.tar). 

12.  Step 11 also generates md5sum files (TAR_NAME.md5sum). These are needed to make sure that the tar files copied to hydra are identical to the ones on lonestar. Change into the directory with tar files and copy them to hydra:

scp TAR_NAME_processed.tar TAR_NAME_raw.tar username@phylocluster.ccbb.utexas.edu:/share/WilkeLab/AG3C/data/experiments/*_time_course/* 

13. Log in to hydra and change into the directory where tar files are. Run:

md5sum TAR_NAME_processed.tar > TAR_NAME_processed.md5sum
md5sum TAR_NAME_raw.tar > TAR_NAME_raw.md5sum

Check that the value given in the TAR_NAME_*.md5sum matches the value given in the TAR_NAME_*.md5sum on lonestar directory. If they are not the same, tar files need to be recopied unto hydra. 

14. Unfold the tar files on hydra:

tar -xvf TAR_NAME_processed.tar
tar -xvf TAR_NAME_raw.tar


 